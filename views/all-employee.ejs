<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <meta name="author" content="Webpixels" />
  <title>Trainity - Admin Panel</title>
  <!-- Favicon -->
  <link rel="icon" href="../img/custom/favicon-32x32.jpg" type="image/png" />
  <!-- Font Awesome 5 -->
  <link rel="stylesheet" href="../libs/@fortawesome/fontawesome-free/css/all.min.css" />
  <!-- Purpose CSS -->
  <link rel="stylesheet" href="../css/purpose.css" id="stylesheet" />
  <!-- Font Awesome 5 -->
  <link rel="stylesheet" href="../libs/@fortawesome/fontawesome-free/css/all.min.css" />
  <!-- Page CSS -->
  <link rel="stylesheet" href="../libs/fullcalendar/dist/fullcalendar.min.css" />

  <link rel="stylesheet" href="//cdn.quilljs.com/1.3.6/quill.bubble.css" />
  <style>
    body {
      font-family: "Manrope", sans-serif !important;
    }
    .inputfield{
      display: flex;
height: 40px;
padding: 8px 16px;
align-items: center;
gap: 16px;
align-self: stretch;
border-radius: 8px;
width:100%;
border: 1px solid var(--stroke-secondary, #DCDCDC);
background: var(--surface-primary, #FFF);

font-size: 14px;
font-style: normal;
font-weight: 600;
line-height: 16px;
    }
    .display-none{
      display:none;
    }
    .display-flex{
      display:flex;
    }
  </style>
  <!-- Hotjar Tracking Code for Admin Website -->
  <script>
    (function(h, o, t, j, a, r) {
      h.hj =
        h.hj ||
        function() {
          (h.hj.q = h.hj.q || []).push(arguments);
        };
      h._hjSettings = {
        hjid: 3534926,
        hjsv: 6,
      };
      a = o.getElementsByTagName("head")[0];
      r = o.createElement("script");
      r.async = 1;
      r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
      a.appendChild(r);
    })(window, document, "https://static.hotjar.com/c/hotjar-", ".js?sv=");
  </script>
</head>

<body class="application application-offset" style="background: white;margin-left:300px;width: calc(100vw - 300px);" id="MainPageContent">
  <!-- Chat modal -->

  <!-- Application container -->
  <div >
    <!-- Sidenav -->
    <div class="navbar-sidebar"><%- include('partials/sidepanel'); -%></div>
    <!-- Content -->
    <div class="main-content position-relative">
      <!-- Main nav -->

     
      <div class="page-content" style="margin: 0px;">
        <%- include('partials/utility-modals'); -%>
        <!-- Page title -->
        <div class="page-title">
          <div class="row justify-content-between align-items-center">
            <div class="text  d-flex align-items-center justify-content-between justify-content-md-start mb-3 mb-md-0">
              <div style="
                    display: flex;
                    padding: 24px 32px;
                    flex-direction: column;
                    align-items: flex-start;
                    border-radius: 14px;
                    ">
                <div style="display: flex;justify-content: space-between;width:100%">
                  <div style="
                      display: flex;
                      justify-content: center;
                    align-items: center;
                        color: #000;
                        font-size: 20px;
                        font-style: normal;
                        font-weight: 700;
                        line-height: normal;
                      ">
                    All Employees
                  </div>

                  <div style="
                        display: flex;
                        padding: 8px 16px;
                        justify-content: center;
                        align-items: center;
                        gap: 8px;
                      " data-toggle="modal" data-target="#addemployeemanager">
                    <button type="button" class="btn btn-primary btn-icon" style="
                         display: flex;
padding: 8px 16px;
justify-content: center;
align-items: center;
gap: 8px;
border-radius: 12px;
background: var(--surface-button-primary, #48BF84);
                        ">
                      <span class="btn-inner--icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                          <path d="M16.19 2H7.81C4.17 2 2 4.17 2 7.81V16.18C2 19.83 4.17 22 7.81 22H16.18C19.82 22 21.99 19.83 21.99 16.19V7.81C22 4.17 19.83 2 16.19 2ZM16 12.75H12.75V16C12.75 16.41 12.41 16.75 12 16.75C11.59 16.75 11.25 16.41 11.25 16V12.75H8C7.59 12.75 7.25 12.41 7.25 12C7.25 11.59 7.59 11.25 8 11.25H11.25V8C11.25 7.59 11.59 7.25 12 7.25C12.41 7.25 12.75 7.59 12.75 8V11.25H16C16.41 11.25 16.75 11.59 16.75 12C16.75 12.41 16.41 12.75 16 12.75Z" fill="white" />
                        </svg>
                      </span>
                      <span>Add Employee</span>
                    </button>
                  </div>
                </div>
                <div class="input-group input-group-merge" style="border: none; margin:30px 0px;height: 40px;">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1"><i class="fa fa-search" aria-hidden="true"></i></span>
                  </div>
                  <input type="text" class="form-control" placeholder="Search for Employee" aria-describedby="basic-addon1" id="searchInput">
                </div>
                
                <div style="color: #000;
                      font-size: 20px;
                      font-style: normal;
                      font-weight: 600;
                      line-height: normal;margin: 40px 0px 20px;">Unassigned</div>
                <div style="display:flex;flex-wrap: wrap;gap:0px 16px" id="unassigned">
                  <% unassignedemployee.forEach((employee,i) => { %>
                    <div class="card" style="display: flex;
                    width: 112px;
                    height: 132px;
                    padding: 16px 8px 8px 8px;
                    flex-direction: column;
                    align-items: center;
                    gap: 8px;" onmouseover="showIcons('unassignedcard<%=i%>')" onmouseout="removeIcons('unassignedcard<%=i%>')">
                    <div style="display: none;
                    justify-content: space-between;
                    align-items: center;" id="unassignedcard<%=i%>">
                     <div style="position: absolute; top:0px;left:0px;display: flex;
                     width: 32px;
                     height: 32px;
                     padding: 7px;
                     justify-content: center;
                     align-items: center;
                     position: absolute;
                     border-radius: 0px 0px 8px 0px;
                     background: var(--pill-surface-blue, #F4F5FB);
                     " onclick="DeleteEmployee('<%=employee.email%>','<%=employee._id%>')">
                     <img src="../img/icons performance mgmt/desktop/Delete_icon.svg">
                   </div>
                   <div style="position: absolute; top:0px;right:0px;display: flex;
                   width: 32px;
                   height: 32px;
                   padding: 7px;
                   justify-content: center;
                   align-items: center;
                   position: absolute;
                   right: 0.117px;
                   border-radius: 0px 0px 8px 0px;
                   background: var(--pill-surface-blue, #F4F5FB);
                   " onclick="EditEmployee('<%=employee.email%>','<%=employee._id%>')" data-toggle="modal" data-target="#addemployeemanager">
                   <img src="../img/icons performance mgmt/desktop/edit_icon.svg">
                 </div>
                 </div>
                      <img src="<%= employee.image %>" style="width: 64px;
                        height: 64px;
                        flex-shrink: 0;border-radius: 64px;">
                      <div style="display: flex;
                        height: 36px;
                        flex-direction: column;
                        justify-content: center;
                        flex-shrink: 0;
                        align-self: stretch;
                        overflow: hidden;
                        color: var(--text-content-primary, #181818);
                        text-align: center;
                        text-overflow: ellipsis;
                        whitespace: nowrap;
                        font-size: 14px;
                        font-style: normal;
                        font-weight: 400;
                        line-height: 130%;">
                        <%= employee.displayName %>
                      </div>
                    </div>
                  <% }); %>
                </div>
                <div style="color: #000;
      font-size: 20px;
      font-style: normal;
      font-weight: 600;
      line-height: normal;margin: 40px 0px 20px;">Assigned</div>
<div style="display:flex;flex-wrap: wrap;gap:0px 16px" id="assigned">
  <% assignedemployee.forEach((employee,i) => { %>
    <div class="card" style="display: flex;
                        width: 112px;
                        height: 132px;
                        padding: 16px 8px 8px 8px;
                        flex-direction: column;
                        align-items: center;
                        gap: 8px;" onmouseover="showIcons('assignedcard<%=i%>')" onmouseout="removeIcons('assignedcard<%=i%>')">
                        <div style="display: none;
                        justify-content: space-between;
                        align-items: center;" id="assignedcard<%=i%>">
                         <div style="position: absolute; top:0px;left:0px;display: flex;
                         width: 32px;
                         height: 32px;
                         padding: 7px;
                         justify-content: center;
                         align-items: center;
                         position: absolute;
                         border-radius: 0px 0px 8px 0px;
                         background: var(--pill-surface-blue, #F4F5FB);
                         " onclick="DeleteEmployee('<%=employee.email%>','<%=employee._id%>')">
                         <img src="../img/icons performance mgmt/desktop/Delete_icon.svg">
                       </div>
                       <div style="position: absolute; top:0px;right:0px;display: flex;
                       width: 32px;
                       height: 32px;
                       padding: 7px;
                       justify-content: center;
                       align-items: center;
                       position: absolute;
                       right: 0.117px;
                       border-radius: 0px 0px 8px 0px;
                       background: var(--pill-surface-blue, #F4F5FB);
                       " onclick="EditEmployee('<%=employee.email%>','<%=employee._id%>')" data-toggle="modal" data-target="#addemployeemanager">
                       <img src="../img/icons performance mgmt/desktop/edit_icon.svg">
                     </div>
                     </div>
      <img src="<%= employee.image %>" style="width: 64px;
        height: 64px;
        flex-shrink: 0;border-radius: 64px;">
      <div style="display: flex;
        height: 36px;
        flex-direction: column;
        justify-content: center;
        flex-shrink: 0;
        align-self: stretch;
        overflow: hidden;
        color: var(--text-content-primary, #181818);
        text-align: center;
        text-overflow: ellipsis;
        whitespace: nowrap;
        font-size: 14px;
        font-style: normal;
        font-weight: 400;
        line-height: 130%;">
        <%= employee.displayName %>
      </div>
    </div>
  <% }); %>
</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Add intern or manager -->

<div class="modal fade docs-example-modal-lg" id="addemployeemanager" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">

      <div class="modal-header" style="display: flex;
      align-items: center;
      justify-content: space-between;
      height: 70px;">
        <h5 class="modal-title h6" id="myLargeModalLabel">Add a new Manager/Employee</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <img src="../img/icons performance mgmt/desktop/close_40x40.svg" >
        </button>
      </div>
      <div class="modal-body" style="border-radius: 14px;
      background: var(--surface-secondary, #FAFAFA);">
        <form>
          <div class="form-group">
              <label class="form-control-label">Name</label>
              <input type="text" class="inputfield" id="nameinputfield"  placeholder="Ex:Rakesh Bepari">
          </div>
          <div class="form-group">
              <label class="form-control-label">Email</label>
              <input type="email" class="inputfield" id="emailinputfield" placeholder="Ex: ravishkumar432@gmail.com">
          </div>
          <div class="form-group">
              <label class="form-control-label">Phone</label>
              <input type="text" class="inputfield"id="phoneinputfield" data-mask="0000 000 000"  placeholder="Ex: 7854698724">
          </div>

          <div class="form-group">
              <label class="form-control-label">Team</label>
              <input type="text" class="inputfield" id="teaminputfield" placeholder="Ex: Developer, Product, Curriculum">
          </div>
          <div class="form-group">
            <label class="form-control-label">EmployeeMent Type</label>
            <select class="inputfield" id="EmployeeMentTypeinputfield">
              <option value="Full Time">Full Time</option>
              <option value="Intern" selected>Intern</option>
              <option value="Part Time" >Part Time</option>
            </select>
          </div>
          <div class="form-group">
              <label class="form-control-label">Position</label>
              <select class="inputfield" id="positioninputfield">
                <option value="0">Manager</option>
                <option value="1" selected>Employee</option>
              </select>
          </div>
      </form>

      </div>
      <div class="modal-footer" >
        <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="createEmployee()">Submit</button>
      </div>
    </div>
  </div>
</div>


  
<script>
    const searchInput = document.getElementById('searchInput');
  const unassignedList = document.querySelectorAll('#unassigned .card');
  const assignedList = document.querySelectorAll('#assigned .card');

  searchInput.addEventListener('input', handleSearch);

  function handleSearch() {
    const searchText = searchInput.value.toLowerCase();

    const unassignedMatches = Array.from(unassignedList).filter((card) =>
      card.textContent.toLowerCase().includes(searchText)
    );
    const assignedMatches = Array.from(assignedList).filter((card) =>
      card.textContent.toLowerCase().includes(searchText)
    );

    // Move matched cards to the beginning
    unassignedMatches.forEach((card) => card.parentElement.prepend(card));
    assignedMatches.forEach((card) => card.parentElement.prepend(card));
  }
  let editEmployee=false;
    let editEmployeeId;
    let pemail;
   async function EditEmployee(pemail,id)
    { editEmployee = true;
 pemail=pemail;
      let data = await fetch(`/get/manager/${id}`)
        data = await data.json();
        data=data.admin;
  
      editEmployeeId=id;
       document.getElementById('nameinputfield').value=data.displayName;
       document.getElementById('emailinputfield').value=data.email;
      document.getElementById('phoneinputfield').value=data.phone;
      document.getElementById('teaminputfield').value=data.team?data.team:'';
      document.getElementById('positioninputfield').value=data.position;
      document.getElementById('EmployeeMentTypeinputfield').value=data.employmentType;
    }
    async function AddModalEmployee(id)
    { 
       document.getElementById('nameinputfield').value='';
       document.getElementById('emailinputfield').value='';
      document.getElementById('phoneinputfield').value='';
      document.getElementById('teaminputfield').value='';
      document.getElementById('positioninputfield').value=0;
    }
    async function DeleteEmployee(email,employeeId)
    {
     
      try {
        let response = await fetch('/admin/create', {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            employeeId:employeeId,
            email
          })
        })
        response = await response.json();
        
        if (response.status == 200)
         { $("#successModal").modal('show');
          location.reload();}
      } catch (error) {
        console.log(error)
        $("#errorModal").modal('show');
      }
       
    }

    async function createEmployee() {
      const name = document.getElementById('nameinputfield').value;
      const email = document.getElementById('emailinputfield').value;
      const phone = document.getElementById('phoneinputfield').value;
      const team = document.getElementById('teaminputfield').value;
      const position = document.getElementById('positioninputfield').value;
      const employmentType=document.getElementById('EmployeeMentTypeinputfield').value;
      try {
        let response;
        if(editEmployee)
        {
           response = await fetch('/admin/create', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            EmployeeId:editEmployeeId,
            pemail,
            name,
            email,
            employmentType,
            phone,
            team,
            position
          })
        })
        }
        else{
         response = await fetch('/admin/create', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            name,
            email,
            phone,
            employmentType,
            team,
            position
          })
        })
      }
      editEmployee=false;
        response = await response.json();
        if (response.status == 200)
          $("#successModal").modal('show');
      } catch (error) {
        console.log(error)
        $("#errorModal").modal('show');
      }
    }
    function showIcons(id) {

const box = document.getElementById(id);
box.style.display = 'flex';
}

function removeIcons(id) {
const box = document.getElementById(id);
box.style.display = 'none';
}
   
</script>
  <script src="../js/purpose.core.js"></script>
  <script src="../libs/autosize/dist/autosize.min.js"></script>
  <script src="../libs/bootstrap-tagsinput/dist/bootstrap-tagsinput.min.js"></script>
  <script src="../libs/progressbar.js/dist/progressbar.min.js"></script>
  <script src="../libs/apexcharts/dist/apexcharts.min.js"></script>
  <script src="../libs/moment/min/moment.min.js"></script>

  <script src="//cdn.quilljs.com/1.3.6/quill.js"></script>
  <script src="../libs/fullcalendar/dist/fullcalendar.min.js"></script>

  <script src="../js/purpose.js"></script>

  <script src="../js/demo.js"></script>
</body>

</html>
